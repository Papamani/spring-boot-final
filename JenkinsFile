@Library('jenkins-shared-library')_
pipeline {
    agent any
    tools {
        maven "Maven"   
    }   
  
    stages {
        stage('Compile-Build-Test ') {
            steps {
	    	slackNotify 'Building Started'
                build 'BUILD'
            }
        }
        /*stage('SonarQube Analysis'){
            steps{
               sonar 'SONAR'
            }
        }
	     stage('Nexus') {
    		 steps{
          		nexus 'NEXUS' 
       			}
		   }
	*/	   
	stage ('Test Environment')
	{
		steps{
		sh 'ssh -t -t -i /var/lib/jenkins/.ssh/id_rsa ansadmin@172.31.10.200 "ansible-playbook /opt/playbooks/down_test.yml"'
		}
	}
	stage('SecurityScan')
	{
	steps{
	appscan application: 'e1f0cff4-84ac-48cd-a454-3b93259a2488', credentials: 'IBMsecurityscan', email: false, failBuild: false, failBuildNonCompliance: false, failureConditions: [], name: 'myTest', scanner: dynamic_analyzer(hasOptions: true, loginPassword: 'test2', loginUser: 'jarvis2', optimization: 'Normal', scanType: 'Staging', target: 'http://13.233.153.114:8091/myWebApp_Test-1/'), target: '', type: 'Dynamic Analyzer', wait: false
	}
	}
      }
	}
