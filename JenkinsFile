@Library('jenkins-shared-library')_
pipeline {
    agent any
    tools {
        maven "Maven"   
    }   
  
    stages {
        stage('Compile-Build-Test ') {
            steps {
	    	slackNotify 'Building Started'
                build 'BUILD'
            }
        }
        stage('SonarQube Analysis'){
            steps{
               sonar 'SONAR'
            }
        }
	stage('Security Scan'){
	steps{
	appscan application: 'e1f0cff4-84ac-48cd-a454-3b93259a2488', credentials: 'IBMsecurityscan', email: true, failBuild: true, failureConditions: [failure_condition(failureType: 'high', threshold: 100), failure_condition(failureType: 'total', threshold: 100)], name: 'Security Test', scanner: static_analyzer(hasOptions: false, target: '/var/lib/jenkins/workspace/Jarvis5'), type: 'Static Analyzer', wait: true
	}
	}
	     stage('Nexus') {
    		 steps{
          		nexus 'NEXUS' 
       			}
		   }
		   
	stage ('Test Environment')
	{
		steps{
			testEnv 'TESTING'
			approval 'TESTING STAGE'
		}
	}
	stage('Performance Testing')
	{
		steps
		{
			performance()
		}
	}
	stage ('Performance Environment')
	{
		steps{
			perfEnv 'PERFORMANCE'
			approval 'PERFORMANCE STAGE'
		}
	}
	stage ('Production Environment')
	{
		steps{
			prodEnv 'PRODUCTION'
		}
	}		
      }
	}
